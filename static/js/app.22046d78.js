(function(e){function t(t){for(var n,i,o=t[0],u=t[1],l=t[2],c=0,f=[];c<o.length;c++)i=o[c],a[i]&&f.push(a[i][0]),a[i]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);d&&d(t);while(f.length)f.shift()();return s.push.apply(s,l||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],n=!0,i=1;i<r.length;i++){var u=r[i];0!==a[u]&&(n=!1)}n&&(s.splice(t--,1),e=o(o.s=r[0]))}return e}var n={},a={app:0},s=[];function i(e){return o.p+"static/js/"+({about:"about"}[e]||e)+"."+{about:"9560f49d"}[e]+".js"}function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.e=function(e){var t=[],r=a[e];if(0!==r)if(r)t.push(r[2]);else{var n=new Promise(function(t,n){r=a[e]=[t,n]});t.push(r[2]=n);var s,u=document.createElement("script");u.charset="utf-8",u.timeout=120,o.nc&&u.setAttribute("nonce",o.nc),u.src=i(e),s=function(t){u.onerror=u.onload=null,clearTimeout(l);var r=a[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src,i=new Error("Loading chunk "+e+" failed.\n("+n+": "+s+")");i.type=n,i.request=s,r[1](i)}a[e]=void 0}};var l=setTimeout(function(){s({type:"timeout",target:u})},12e4);u.onerror=u.onload=s,document.head.appendChild(u)}return Promise.all(t)},o.m=e,o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var c=0;c<u.length;c++)t(u[c]);var d=l;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("cd49")},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},"95da":function(e,t,r){"use strict";var n=r("aeb9"),a=r.n(n);a.a},9643:function(e,t,r){"use strict";var n=r("d229"),a=r.n(n);a.a},aeb9:function(e,t,r){},cd49:function(e,t,r){"use strict";r.r(t);r("14c6"),r("08c1"),r("4842"),r("d9fc");var n=r("a026"),a=r("bc3a"),s=r.n(a),i={},o=s.a.create(i);o.interceptors.request.use(function(e){return e},function(e){return Promise.reject(e)}),o.interceptors.response.use(function(e){return e},function(e){return Promise.reject(e)}),Plugin.install=function(e,t){e.axios=o,window.axios=o,Object.defineProperties(e.prototype,{axios:{get:function(){return o}},$axios:{get:function(){return o}}})},n["a"].use(Plugin);Plugin;var u=r("bb71");r("da64");n["a"].use(u["a"],{iconfont:"md"});var l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",[r("v-toolbar",{attrs:{app:"",flat:""}},[r("v-toolbar-title",{staticClass:"headline text-uppercase"},[r("span",{staticClass:"font-weight-light"},[e._v("AGIL")]),r("span",[e._v("EFFY")])]),r("v-spacer"),r("v-btn",{attrs:{flat:"",href:"https://github.com/agileffy/Agileffy",target:"_blank"}},[r("span",{staticClass:"mr-2"},[e._v("Contribute")])])],1),r("router-view")],1)},c=[],d={name:"App",data:function(){return{}}},f=d,v=r("2877"),p=r("6544"),h=r.n(p),m=r("7496"),g=r("8336"),b=r("9910"),w=r("71d9"),y=r("2a7f"),x=Object(v["a"])(f,l,c,!1,null,null,null),k=x.exports;h()(x,{VApp:m["a"],VBtn:g["a"],VSpacer:b["a"],VToolbar:w["a"],VToolbarTitle:y["a"]});var T=r("8c4f"),_=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"home"})},M=[],D=r("d225"),S=r("308d"),V=r("6bb5"),j=r("4e2b"),O=r("9ab4"),L=r("60a3"),$=function(e){function t(){return Object(D["a"])(this,t),Object(S["a"])(this,Object(V["a"])(t).apply(this,arguments))}return Object(j["a"])(t,e),t}(L["b"]);$=O["a"]([Object(L["a"])({components:{}})],$);var C=$,P=C,A=Object(v["a"])(P,_,M,!1,null,null,null),R=A.exports,B=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-content",[r("v-container",{attrs:{fluid:"","fill-height":""}},[r("v-layout",{attrs:{"align-center":"","justify-center":""}},[r("v-flex",{attrs:{xs12:"",sm8:"",md4:""}},[r("v-card",{staticClass:"elevation-12"},[r("v-toolbar",{attrs:{dark:"",color:"#4DBA87"}},[r("v-toolbar-title",[e._v("Login to Agileffy")]),r("v-spacer")],1),r("v-card-text",[r("v-form",{model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[r("v-text-field",{attrs:{"prepend-icon":"person",name:"login",label:"Login",type:"text",rules:[e.rules.required],"test-input-username":""},model:{value:e.userdata.username,callback:function(t){e.$set(e.userdata,"username",t)},expression:"userdata.username"}}),r("v-text-field",{attrs:{"prepend-icon":"lock",name:"password",label:"Password",id:"password",type:"password",rules:[e.rules.required],"test-input-password":""},model:{value:e.userdata.password,callback:function(t){e.$set(e.userdata,"password",t)},expression:"userdata.password"}})],1)],1),r("v-card-actions",[r("v-btn",{attrs:{flat:"",small:"",color:"primary","test-btn-register":""},on:{click:e.jumpToRegister}},[e._v("Register")]),r("v-spacer"),r("v-btn",{attrs:{disabled:!e.valid,color:"primary","test-btn-submit":""},on:{click:e.login}},[e._v("Login")])],1),r("v-alert",{attrs:{value:e.errmsg,color:"error",icon:"warning",outline:""}},[e._v(e._s(e.errmsg))])],1)],1)],1)],1)],1)},I=[],q={data:function(){return{drawer:null,valid:!1,userdata:{username:"",password:""},rules:{required:function(e){return!!e||"This is required!"}},errmsg:""}},props:{source:String},methods:{login:function(){var e=this;axios.post("/api/login",this.userdata).then(function(t){"OK"===t.data?e.$router.push("/write"):e.errmsg=t.data}).catch(function(t){e.errmsg="ERROR:"+t.response.status+" "+t.response.statusText})},jumpToRegister:function(){this.$router.push("/register")}}},E=q,N=r("0798"),F=r("b0af"),H=r("99d9"),K=r("a523"),z=r("549c"),W=r("0e8f"),Z=r("4bd4"),Y=r("a722"),J=r("2677"),U=Object(v["a"])(E,B,I,!1,null,null,null),G=U.exports;h()(U,{VAlert:N["a"],VBtn:g["a"],VCard:F["a"],VCardActions:H["a"],VCardText:H["b"],VContainer:K["a"],VContent:z["a"],VFlex:W["a"],VForm:Z["a"],VLayout:Y["a"],VSpacer:b["a"],VTextField:J["a"],VToolbar:w["a"],VToolbarTitle:y["a"]});var Q=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("v-navigation-drawer",{attrs:{fixed:"",right:"",clipped:"",app:""},model:{value:e.drawerRight,callback:function(t){e.drawerRight=t},expression:"drawerRight"}},[r("v-list",{attrs:{dense:""}},[r("v-toolbar",{staticClass:"transparent",attrs:{flat:""}},[r("v-list",{staticClass:"pa-0"},[r("v-list-tile",{attrs:{avatar:""}},[r("v-list-tile-avatar",[r("img",{attrs:{src:e.userinfo.avatar}})]),r("v-list-tile-content",[r("v-list-tile-title",[e._v(e._s(e.userinfo.username))])],1)],1)],1)],1),r("v-list",{staticClass:"pt-0",attrs:{dense:""}},[r("v-divider"),r("v-list-tile",[r("v-list-tile-action",[r("v-icon",{attrs:{color:e.syncStatus?"green":"red"}},[e._v("sync")])],1),r("v-list-tile-content",[r("v-list-tile-title",[e._v("Sync Status")])],1)],1),r("v-list-tile",[r("v-list-tile-action",[r("v-icon",[e._v("storage")])],1),r("v-list-tile-content",[r("v-list-tile-title",[e._v("Your documents: "+e._s(e.numDocs))])],1)],1)],1)],1)],1),r("Toolbar",{attrs:{numMessages:e.numSelected,mode:e.mode},on:{edit:e.editSelected,copy:e.copySelected,delete:e.removeSelected,forward:e.showLeftDrawer,merge:e.mergeSelected,revertMode:e.revertMode,showLeftDrawer:e.showLeftDrawer,showRightDrawer:e.showRightDrawer}}),r("v-navigation-drawer",{attrs:{fixed:"",app:""},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[r("v-list",{attrs:{dense:""}},[r("v-list-tile",[r("v-list-tile-action",[r("v-icon",{on:{click:function(t){return t.stopPropagation(),e.createDoc(t)}}},[e._v("add")])],1),r("v-list-tile-content",[r("v-text-field",{attrs:{type:"text",placeholder:"Create New Document",required:""},model:{value:e.newDocName,callback:function(t){e.newDocName=t},expression:"newDocName"}}),r("v-list-tile-title",[e._v("Create New Document")])],1)],1),r("v-subheader",[e._v("Documents")]),r("draggable",{staticStyle:{"min-height":"10px"},attrs:{list:e.msgLists,group:"doc"}},[e._l(e.msgLists,function(t){return[r("v-list-tile",{key:t.id,on:{click:function(r){return r.stopPropagation(),e.clickOnDoc(t)}}},[r("v-list-tile-content",[r("v-list-tile-title",{domProps:{innerHTML:e._s(t.name)}}),r("v-list-tile-sub-title",[e._v("It has "+e._s(t.list.length)+" messages")])],1)],1)]})],2)],1)],1),r("v-content",{attrs:{id:"Content"}},[r("v-container",{ref:"msgContainer",attrs:{id:"MessagePile","pa-0":""}},[r("v-layout",{attrs:{row:"","justify-center":"","align-center":""}},[r("v-flex",{attrs:{xs12:""}},[r("draggable",{attrs:{list:e.messages.list,group:"messages"},on:{change:e.listChanges}},[e._l(e.messages.list,function(t){return[r("v-card",{key:t.updateTime,class:{selected:t.selected},attrs:{flat:"","pa-3":"","ma-3":""},on:{dblclick:function(r){return e.select(t)}}},[r("div",[r("MessageBlock",{attrs:{msg:t},on:{"edit-block":e.editBlock}})],1)])]})],2)],1)],1)],1),r("v-divider"),r("v-container",{ref:"typeWriterContainer",attrs:{id:"Typer","ma-0":"","pa-0":""}},[r("v-layout",{attrs:{row:"","fill-height":""}},[r("v-flex",{attrs:{xs11:""}},[r("div",{ref:"userInput",attrs:{"ma-0":"","pa-0":"",contenteditable:"true",id:"Input"},on:{input:e.inputting,keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?t.shiftKey||t.altKey||t.metaKey?null:e.spark(t):null}}},[r("p",[e._v("Type some thing please")])])]),r("v-flex",{attrs:{xs1:""}},[r("v-btn",{staticStyle:{buttom:"10px",position:"absolute"},attrs:{icon:"",small:"",absolute:"",right:"",depressed:"",fab:"",color:"#4DBA87"},on:{click:e.spark}},[r("v-icon",[e._v("add")])],1)],1)],1)],1)],1)],1)},X=[],ee=(r("96cf"),r("3b8d")),te=(r("ac4d"),r("8a81"),r("ac6a"),r("7f7f"),r("310e")),re=r.n(te),ne=(r("1c46"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"message",on:{click:e.edit}},[r("div",{ref:"msgBlock"}),r("div",{staticClass:"status"},[e._v("last edit: "+e._s(e.timeToRender))])])}),ae=[],se=r("0e54"),ie=r.n(se),oe=(r("7514"),r("b0b4")),ue=r("11c1"),le=r("16b2"),ce=function e(){Object(D["a"])(this,e),this.msgdb=new le["a"]("msg"),this.lstdb=new le["a"]("lst"),this.tagdb=new le["a"]("tag")},de=new ce,fe=r("5d16");le["a"].plugin(fe["a"]);var ve=function(){function e(t){Object(D["a"])(this,e),this.id=Object(ue["v1"])(),this.content=t,this.selected=!1;var r=new Date;this.timestamp=r.getTime(),this.updateTime=r.getTime(),this.tags=[]}return Object(oe["a"])(e,null,[{key:"fromDoc",value:function(t,r,n,a,s,i){var o=new e(n);return o.id=t,o.rev=r,o.timestamp=a,o.updateTime=s,o.tags=i,o}}]),Object(oe["a"])(e,[{key:"getID",value:function(){return this.id}},{key:"toDoc",value:function(){return{_id:this.getID(),content:this.content,timestamp:this.timestamp,updateTime:this.updateTime,tags:this.tags}}},{key:"updateContent",value:function(e){this.content=e;var t=new Date;this.updateTime=t.getTime()}},{key:"setTags",value:function(e){this.tags=[];var t=!0,r=!1,n=void 0;try{for(var a,s=e[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var i=a.value;this.tags.push(i.getID())}}catch(o){r=!0,n=o}finally{try{t||null==s.return||s.return()}finally{if(r)throw n}}}}]),e}(),pe=function(){function e(){Object(D["a"])(this,e),this.db=de.msgdb}return Object(oe["a"])(e,[{key:"putMsg",value:function(e){var t=e.toDoc();return this.db.put(t)}},{key:"newMsg",value:function(e){var t=new ve(e),r=t.toDoc();return this.db.put(r),t}},{key:"getMessages",value:function(e){var t=this,r=[];return e.reduce(function(){var e=Object(ee["a"])(regeneratorRuntime.mark(function e(n,a){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n;case 2:return e.abrupt("return",t.getMsg(a).then(function(e){r.push(e)}));case 3:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),Promise.resolve()).then(function(){return r})}},{key:"getMsg",value:function(e){return this.db.get(e).then(function(e){var t=ve.fromDoc(e._id,e._rev,e.content,e.timestamp,e.updateTime,e.tags);return t})}},{key:"getMsgByTag",value:function(e){var t=this;return this.db.createIndex({index:{fields:["tags"]}}).then(function(){return t.db.find({selector:{tags:{$elemMatch:e.getID()}}})}).then(function(e){var r=[],n=!0,a=!1,s=void 0;try{for(var i,o=e.docs[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var u=i.value,l=u._id;t.db.get(l).then(function(e){r.push(ve.fromDoc(e._id,e._rev,e.content,e.timestamp,e.updateTime,e.tags))})}}catch(c){a=!0,s=c}finally{try{n||null==o.return||o.return()}finally{if(a)throw s}}return new Promise(function(e){r.length>0&&e(r)})})}},{key:"getAllMessages",value:function(){return this.db.allDocs({include_docs:!0}).then(function(e){var t=[],r=!0,n=!1,a=void 0;try{for(var s,i=e.rows[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var o=s.value,u=o.doc;t.push(ve.fromDoc(u._id,u._rev,u.content,u.timestamp,u.updateTime,u.tags))}}catch(l){n=!0,a=l}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}return new Promise(function(e){t.length>0&&e(t)})})}},{key:"updateMessage",value:function(e){var t=this;this.db.get(e.getID()).then(function(r){return t.db.put({_id:e.getID(),_rev:r._rev,content:e.content,updateTime:e.updateTime})})}}]),e}(),he=new pe;function me(e){var t=new Date,r=t.getTime()-e;t.setTime(e);var n=60*(new Date).getHours()*60*1e3+60*(new Date).getMinutes()*1e3+1e3*(new Date).getSeconds(),a=n+864e5,s=n+432e6;if(r>s)return t.toLocaleString();if(r>a){var i=new Array("星期一","星期二","星期三","星期四","星期五","星期六","星期日");return i[t.getDay()]+" "+t.toLocaleTimeString()}return r>n?"昨天 "+t.toLocaleTimeString():t.toLocaleTimeString()}var ge={props:{msg:ve},data:function(){return{timeToRender:""}},mounted:function(){this.render()},methods:{render:function(){var e=ie()(this.msg.content);this.$refs.msgBlock.innerHTML=e,this.timeToRender=me(this.msg.updateTime)},edit:function(){this.$emit("edit-block",this.msg)}}},be=ge,we=(r("95da"),Object(v["a"])(be,ne,ae,!1,null,null,null)),ye=we.exports,xe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-toolbar",{attrs:{color:"#4DBA87",dark:"",fixed:"",app:"","clipped-right":"",flat:""}},[r("v-btn",{attrs:{icon:""},on:{click:function(t){return t.stopPropagation(),e.leftButtonClick(t)}}},[r("v-icon",[e._v(e._s(e.leftButton))])],1),r("v-toolbar-title",[e._v(e._s(e.msg))]),r("v-spacer"),e._e(),"selected"===e.mode?r("v-btn",{attrs:{icon:""},on:{click:function(t){return t.stopPropagation(),e.copyMsg(t)}}},[r("v-icon",[e._v("file_copy")])],1):e._e(),"selected"===e.mode?r("v-btn",{attrs:{icon:""},on:{click:function(t){return t.stopPropagation(),e.forwardMsg(t)}}},[r("v-icon",[e._v("forward")])],1):e._e(),"selected"===e.mode?r("v-btn",{attrs:{icon:""},on:{click:function(t){return t.stopPropagation(),e.deleteMsg(t)}}},[r("v-icon",[e._v("delete")])],1):e._e(),"selected"===e.mode?r("v-btn",{attrs:{icon:""},on:{click:function(t){return t.stopPropagation(),e.mergeMsg(t)}}},[r("v-icon",[e._v("merge_type")])],1):e._e(),"normal"===e.mode?r("v-btn",{attrs:{icon:""},on:{click:function(t){return t.stopPropagation(),e.rightButtonClick(t)}}},[r("v-icon",[e._v("menu")])],1):e._e()],1)},ke=[],Te=(r("c5f6"),{props:{mode:String,numMessages:Number},data:function(){return{leftButton:"menu",msg:"Agileffy"}},watch:{$props:{immediate:!0,deep:!0,handler:function(){"selected"===this.mode?(this.leftButton="close",this.msg=String(this.numMessages)):(this.leftButton="menu",this.msg="Agileffy")}}},methods:{refresh:function(){"selected"===this.mode?(this.leftButton="close",this.msg=String(this.numMessages)):(this.leftButton="menu",this.msg="Agileffy")},leftButtonClick:function(){"normal"===this.mode?this.$emit("showLeftDrawer"):"selected"===this.mode&&this.$emit("revertMode")},editMsg:function(){this.$emit("edit")},copyMsg:function(){this.$emit("copy")},deleteMsg:function(){this.$emit("delete")},forwardMsg:function(){this.$emit("forward")},mergeMsg:function(){this.$emit("merge")},rightButtonClick:function(){this.$emit("showRightDrawer")}}}),_e=Te,Me=r("132d"),De=Object(v["a"])(_e,xe,ke,!1,null,null,null),Se=De.exports;h()(De,{VBtn:g["a"],VIcon:Me["a"],VSpacer:b["a"],VToolbar:w["a"],VToolbarTitle:y["a"]});r("55dd");var Ve=function(){function e(t,r){Object(D["a"])(this,e),this.id=Object(ue["v1"])(),this.name=t||"Not Named",this.list=r||new Array}return Object(oe["a"])(e,null,[{key:"fromDoc",value:function(t,r,n,a){return he.getMessages(n).then(function(n){var s=new e(a,n);return s.id=t,s.rev=r,s})}}]),Object(oe["a"])(e,[{key:"getID",value:function(){return this.id}},{key:"toDoc",value:function(e){var t=new Array,r=!0,n=!1,a=void 0;try{for(var s,i=this.list[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var o=s.value;t.push(o.getID())}}catch(l){n=!0,a=l}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}var u={_id:this.id,_rev:e||this.rev,name:this.name,list:t};return u}},{key:"extractSelected",value:function(){var t=new Array,r=!0,n=!1,a=void 0;try{for(var s,i=this.list[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var o=s.value;o.selected&&t.push(o)}}catch(u){n=!0,a=u}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}return new e("new",t)}},{key:"duplicate",value:function(){var t=new Array,r=!0,n=!1,a=void 0;try{for(var s,i=this.list[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var o=s.value,u=new ve(o.content);he.putMsg(u),t.push(u)}}catch(l){n=!0,a=l}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}return new e("new",t)}},{key:"removeSelected",value:function(){var e=new Array,t=!0,r=!1,n=void 0;try{for(var a,s=this.list[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var i=a.value;i.selected||e.push(i)}}catch(o){r=!0,n=o}finally{try{t||null==s.return||s.return()}finally{if(r)throw n}}this.list=e}},{key:"appendMsgList",value:function(e){this.list=this.list.concat(e.list)}},{key:"toMsg",value:function(){var e="",t=!0,r=!1,n=void 0;try{for(var a,s=this.list[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var i=a.value;e+="\n\n"+i.content}}catch(u){r=!0,n=u}finally{try{t||null==s.return||s.return()}finally{if(r)throw n}}var o=new ve(e);return he.putMsg(o),o}},{key:"extractMsg",value:function(e){var t=new Array,r=!0,n=!1,a=void 0;try{for(var s,i=e[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var o=s.value;t.push(e[o])}}catch(u){n=!0,a=u}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}return this.remove(e),t}},{key:"push",value:function(e){this.list.push(e)}},{key:"remove",value:function(e){var t=new Array;e.sort(function(e,t){return e-t});for(var r=0,n=0;n<this.list.length;n++){while(r<e.length&&e[r]<n)r++;e[r]!==n&&t.push(this.list[n])}this.list=t}}]),e}(),je=function(){function e(){Object(D["a"])(this,e),this.db=de.lstdb}return Object(oe["a"])(e,[{key:"getMsgList",value:function(e){return this.db.get(e).then(function(e){return Ve.fromDoc(e._id,e._rev,e.list,e.name)})}},{key:"putMsgList",value:function(e){var t=e.toDoc();return this.db.put(t)}},{key:"updateMsgList",value:function(e){var t=this;this.db.get(e.getID()).then(function(r){return t.db.put(e.toDoc(r._rev))})}},{key:"getAllList",value:function(){return this.db.allDocs({include_docs:!0}).then(function(e){var t=[];return e.rows.reduce(function(){var e=Object(ee["a"])(regeneratorRuntime.mark(function e(r,n){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r;case 2:return a=n.doc,e.abrupt("return",Ve.fromDoc(a._id,a._rev,a.list,a.name).then(function(e){t.push(e)}));case 4:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}(),Promise.resolve()).then(function(){return t})})}}]),e}(),Oe=new je,Le=r("7618"),$e=function(){function e(t,r,n){if(Object(D["a"])(this,e),this.id=r||Object(ue["v1"])(),this.name=t,n)this.createTime=n;else{var a=new Date;this.createTime=a.getTime()}}return Object(oe["a"])(e,[{key:"getID",value:function(){return this.id}},{key:"toDoc",value:function(){return{_id:this.getID(),name:this.name,createTime:this.createTime}}}]),e}();le["a"].plugin(fe["a"]);var Ce=function(){function e(){Object(D["a"])(this,e),this.db=de.tagdb}return Object(oe["a"])(e,[{key:"putTag",value:function(e){var t=e.toDoc();this.db.put(t)}},{key:"getAllTags",value:function(){return this.db.allDocs({include_docs:!0}).then(function(e){var t=[],r=!0,n=!1,a=void 0;try{for(var s,i=e.rows[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var o=s.value,u=o.doc;t.push(new $e(u.name,u._id,u.createTime))}}catch(l){n=!0,a=l}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}return new Promise(function(e){t.length>0&&e(t)})})}},{key:"getTagByName",value:function(e){var t=this;return this.db.createIndex({index:{fields:["name"]}}).then(function(){return t.db.find({selector:{name:{$eq:e}}})}).then(function(r){if(0===r.docs.length){var n=new $e(e);return t.putTag(n),new Promise(function(e){e(n)})}var a=function(){var e=[],n=!0,a=!1,s=void 0;try{for(var i,o=r.docs[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var u=i.value,l=u._id;t.db.get(l).then(function(t){e.push(new $e(t.name,t._id,t.createTime))})}}catch(c){a=!0,s=c}finally{try{n||null==o.return||o.return()}finally{if(a)throw s}}return{v:new Promise(function(t){e.length>0&&t(e[0])})}}();if("object"===Object(Le["a"])(a))return a.v})}}]),e}(),Pe=new Ce;r("4917");function Ae(e){var t=/(#(\w+))/g,r=e.match(t);return r}var Re={components:{MessageBlock:ye,draggable:re.a,Toolbar:Se},props:{source:String},data:function(){return{drawer:!1,drawerRight:!1,msgLists:null,listId:"",messages:new Ve("TempMessagePile"),msgToEdit:null,numSelected:0,mode:"normal",userinfo:{avatar:"https://avatars2.githubusercontent.com/u/49611995?s=200&v=4",username:"Admin"},syncStatus:!0,numDocs:0,newDocName:""}},created:function(){var e=this;Oe.getAllList().then(function(t){e.msgLists=t,console.log(t);var r=!0,n=!1,a=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var o=s.value;"MessagePile"===o.name&&(e.messages=o,e.listId=o.id)}}catch(u){n=!0,a=u}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}"TempMessagePile"===e.messages.name&&(e.messages.name="MessagePile",Oe.putMsgList(e.messages),e.msgLists.push(e.messages))})},methods:{revertMode:function(){this.mode="normal";var e=!0,t=!1,r=void 0;try{for(var n,a=this.messages.list[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var s=n.value;s.selected=!1}}catch(i){t=!0,r=i}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}this.numSelected=0},clickOnDoc:function(e){"normal"===this.mode?this.messages=e:this.forwardSelected(e)},createDoc:function(){var e=new Ve(this.newDocName||"New Document");this.msgLists.push(e),Oe.putMsgList(e)},listChanges:function(e){Oe.updateMsgList(this.messages)},updateMsgList:function(){Oe.updateMsgList(this.messages)},select:function(e){e.selected=!e.selected,e.selected?this.numSelected++:this.numSelected--,0===this.numSelected?this.mode="normal":this.mode="selected"},removeSelected:function(){this.messages.removeSelected(),this.updateMsgList()},forwardSelected:function(e){var t=this.messages.extractSelected();e.appendMsgList(t),this.messages.removeSelected(),Oe.updateMsgList(e),Oe.updateMsgList(this.messages),this.messages=e},mergeSelected:function(){var e=this.messages.extractSelected(),t=e.toMsg();this.messages.push(t),Oe.updateMsgList(this.messages)},showLeftDrawer:function(){this.drawer=!this.drawer},showRightDrawer:function(){this.drawerRight=!this.drawerRight},editSelected:function(){setTimeout(function(){alert("糙米吗")},1e3)},copySelected:function(){var e=this.messages.extractSelected();this.messages.appendMsgList(e.duplicate()),Oe.updateMsgList(this.messages)},inputting:function(){this.resetHeight()},spark:function(){var e=this,t=function(){var t=Object(ee["a"])(regeneratorRuntime.mark(function t(){var r,n,a,s,i,o,u,l,c,d;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(r=Ae(e.$refs.userInput.innerText),n=new Array,!r){t.next=31;break}a=!0,s=!1,i=void 0,t.prev=6,o=r[Symbol.iterator]();case 8:if(a=(u=o.next()).done){t.next=17;break}return l=u.value,t.next=12,Pe.getTagByName(l);case 12:c=t.sent,n.push(c);case 14:a=!0,t.next=8;break;case 17:t.next=23;break;case 19:t.prev=19,t.t0=t["catch"](6),s=!0,i=t.t0;case 23:t.prev=23,t.prev=24,a||null==o.return||o.return();case 26:if(t.prev=26,!s){t.next=29;break}throw i;case 29:return t.finish(26);case 30:return t.finish(23);case 31:e.msgToEdit?(e.msgToEdit.updateContent(e.$refs.userInput.innerText),e.msgToEdit.setTags(n),he.updateMessage(e.msgToEdit),e.msgToEdit=null):(d=new ve(e.$refs.userInput.innerText),d.setTags(n),he.putMsg(d),e.messages.push(d)),setTimeout(e.scrollView,1),e.clearTypeWriter(),e.resetHeight(),e.updateMsgList();case 36:case"end":return t.stop()}},t,null,[[6,19,23,31],[24,,26,30]])}));return function(){return t.apply(this,arguments)}}();t()},resetHeight:function(){var e=this.$refs.msgContainer.parentElement.offsetHeight-this.$refs.typeWriterContainer.offsetHeight;this.$refs.msgContainer.style.height=e+"px"},scrollView:function(){this.$refs.msgContainer.scrollTop=this.$refs.msgContainer.scrollHeight},clearTypeWriter:function(){this.$refs.userInput.innerText="And more?"},editBlock:function(e){this.$refs.userInput.innerText=e.content,this.resetHeight(),this.msgToEdit=e}},mounted:function(){this.resetHeight(),setTimeout(this.scrollView,10)}},Be=Re,Ie=(r("9643"),r("ce7e")),qe=r("8860"),Ee=r("ba95"),Ne=r("40fe"),Fe=r("c954"),He=r("5d23"),Ke=r("f774"),ze=r("e0c7"),We=Object(v["a"])(Be,Q,X,!1,null,null,null),Ze=We.exports;h()(We,{VBtn:g["a"],VCard:F["a"],VContainer:K["a"],VContent:z["a"],VDivider:Ie["a"],VFlex:W["a"],VIcon:Me["a"],VLayout:Y["a"],VList:qe["a"],VListTile:Ee["a"],VListTileAction:Ne["a"],VListTileAvatar:Fe["a"],VListTileContent:He["a"],VListTileSubTitle:He["b"],VListTileTitle:He["c"],VNavigationDrawer:Ke["a"],VSubheader:ze["a"],VTextField:J["a"],VToolbar:w["a"]});var Ye=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-content",[r("v-container",{attrs:{fluid:"","fill-height":""}},[r("v-layout",{attrs:{"align-center":"","justify-center":""}},[r("v-flex",{attrs:{xs12:"",sm8:"",md4:""}},[r("v-card",{staticClass:"elevation-12"},[r("v-toolbar",{attrs:{dark:"",color:"#4DBA87"}},[r("v-toolbar-title",[e._v("Create a new account")]),r("v-spacer")],1),r("v-card-text",[r("v-form",{ref:"form",attrs:{"test-form-register":""},model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[r("v-text-field",{attrs:{rules:[e.rules.required,e.rules.min,e.rules.max,e.rules.username],"prepend-icon":"person",name:"username",label:"Username",type:"text",counter:"",required:"","test-input-username":""},model:{value:e.userdata.username,callback:function(t){e.$set(e.userdata,"username",t)},expression:"userdata.username"}}),r("v-text-field",{attrs:{rules:[e.rules.required,e.rules.password],error:e.passwordRepeatRule(),"append-icon":e.showPassword?"visibility":"visibility_off","prepend-icon":"lock",name:"password",label:"Password",id:"password",type:e.showPassword?"text":"password",required:"","test-input-password":""},on:{"click:append":function(t){e.showPassword=!e.showPassword}},model:{value:e.userdata.password,callback:function(t){e.$set(e.userdata,"password",t)},expression:"userdata.password"}}),r("v-text-field",{attrs:{rules:[e.rules.required],error:e.passwordRepeatRule(),"error-messages":e.passwordRepeatMsg(),"append-icon":e.showPassword?"visibility":"visibility_off","prepend-icon":"lock",name:"password2",label:"Password Again",id:"password2",type:e.showPassword?"text":"password",required:"","test-input-passwordrepeat":""},on:{"click:append":function(t){e.showPassword=!e.showPassword}},model:{value:e.userdata.passwordRepeat,callback:function(t){e.$set(e.userdata,"passwordRepeat",t)},expression:"userdata.passwordRepeat"}}),r("v-text-field",{attrs:{rules:[e.rules.required,e.rules.email],"prepend-icon":"email",name:"email",label:"Email",type:"text",required:"","test-input-email":""},model:{value:e.userdata.email,callback:function(t){e.$set(e.userdata,"email",t)},expression:"userdata.email"}}),r("v-checkbox",{attrs:{rules:[e.rules.required,e.rules.checkbox],label:"Do you agree?",required:"","test-checkbox-termagree":""},model:{value:e.checkbox,callback:function(t){e.checkbox=t},expression:"checkbox"}})],1)],1),r("v-card-actions",[r("v-spacer"),r("v-btn",{attrs:{color:"error","test-btn-cancel":""},on:{click:e.cancel}},[e._v("Cancel")]),r("v-btn",{attrs:{disabled:!e.valid,color:"primary","test-btn-submit":""},on:{click:e.register}},[e._v("Register")])],1),r("v-alert",{attrs:{value:e.errmsg,color:"error",icon:"warning",outline:""}},[e._v(e._s(e.errmsg))])],1)],1)],1)],1)],1)},Je=[],Ue={data:function(){return{valid:!1,userdata:{username:"",password:"",passwordRepeat:"",email:""},checkbox:!1,showPassword:!1,rules:{required:function(e){return!!e||"This is required!"},min:function(e){return(e||"").length>=6||"Min 6 characters required!"},max:function(e){return(e||"").length<=30||"Max 30 characters required!"},username:function(e){var t=/^[a-zA-Z]{1}([a-zA-Z0-9]|[._-]){5,29}$/;return t.test(e)||"Username should start with a letter, following with letters,digits and special characters(._-)."},password:function(e){var t=/^(?![A-Z]+$)(?![a-z]+$)(?!\d+$)(?![\W_]+$)\S{8,30}$/;return t.test(e)||"Password should contains at least two of these four types of characters: lowercase letters,                         uppercase letters, digits, special characters(.,_!@#$%^&*`~()-+=)                         and should have a length between 8 and 30."},email:function(e){var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)||"Invalid e-mail."},checkbox:function(e){return!!e||"You must agree to continue!"}},errmsg:""}},methods:{passwordRepeatRule:function(){return this.userdata.password!==this.userdata.passwordRepeat},passwordRepeatMsg:function(){if(this.userdata.password!==this.userdata.passwordRepeat)return"Password does not match!"},register:function(){var e=this;this.$refs.form.validate()&&axios.post("/api/register",{username:this.userdata.username,password:this.userdata.password,email:this.userdata.email}).then(function(t){"OK"===t.data?e.$router.push("/write"):e.errmsg=t.data}).catch(function(t){e.errmsg="ERROR:"+t.response.status+" "+t.response.statusText})},cancel:function(){this.$router.push("/")}}},Ge=Ue,Qe=r("ac7c"),Xe=Object(v["a"])(Ge,Ye,Je,!1,null,null,null),et=Xe.exports;h()(Xe,{VAlert:N["a"],VBtn:g["a"],VCard:F["a"],VCardActions:H["a"],VCardText:H["b"],VCheckbox:Qe["a"],VContainer:K["a"],VContent:z["a"],VFlex:W["a"],VForm:Z["a"],VLayout:Y["a"],VSpacer:b["a"],VTextField:J["a"],VToolbar:w["a"],VToolbarTitle:y["a"]}),n["a"].use(T["a"]);var tt=new T["a"]({routes:[{path:"/home",name:"home",component:R},{path:"/",name:"login",component:G},{path:"/register",name:"register",component:et},{path:"/about",name:"about",component:function(){return r.e("about").then(r.bind(null,"f820"))}},{path:"/write",name:"write",component:Ze}]}),rt=r("2f62");n["a"].use(rt["a"]);var nt=new rt["a"].Store({state:{},mutations:{},actions:{}}),at=r("9483");Object(at["a"])("".concat("/","sw.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),n["a"].config.productionTip=!1,new n["a"]({router:tt,store:nt,render:function(e){return e(k)}}).$mount("#app")},d229:function(e,t,r){}});
//# sourceMappingURL=app.22046d78.js.map